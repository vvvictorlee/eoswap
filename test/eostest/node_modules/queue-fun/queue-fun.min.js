/**
 * queue-fun v0.3.1
 * https://github.com/cnwhy/queue-fun
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){c.Queue=a("./lib/Queue.js"),c.Q=a("./lib/Q.js")},{"./lib/Q.js":2,"./lib/Queue.js":3}],2:[function(a,b,c){(function(a){"use strict";function c(a,b){~this.state||(this.state=a,a?this.value=b:this.reason=b,f.call(this))}function d(){this.state=-1,this.event=[]}function e(a,b,c,d){a="function"==typeof a?a:null,b="function"==typeof b?b:null,this.event.push([a,b,c,d])}function f(){if(~this.state){var a=this,b=a.event,c=a.state?a.value:a.reason,e=a.state?0:1;h(function(){for(;b.length;)!function(b){var f,g=b[e],h=b[2],i=b[3];if(g)try{if(f=i?g.apply(null,[].concat(c)):g.call(null,c),a===f)throw"TypeError"}catch(j){if(!h)throw j;h.reject(j)}if(h){var k=typeof f,l=function(a){h.reject(a)};if(f instanceof d||("function"==k||"object"==k)&&"function"==typeof f.then)try{f.then.call(f,h.resolve,h.reject)}catch(j){l(j)}else g?h.resolve(f):a.state?h.resolve(c):h.reject(c)}}(a.event.shift())},0)}}function g(a){return function(b,c){return b?a.reject(b):void a.resolve(c)}}var h="object"==typeof a&&a.nextTick?a.nextTick:setTimeout,i=function(a){return l(a)};i.defer=function(){return new j},i.Promise=function(a){if("function"!=typeof a)throw"TypeError";var b=new j;return a(b.resolve,b.reject),b.promise};var j=function(){var a=(new Date,this.promise=new d);this.resolve=function(b){c.call(a,1,b)},this.reject=function(b){c.call(a,0,b)}},k=["pending","rejected","fulfilled"];j.prototype.getState=function(){return k[this.promise.state+1]},d.prototype={done:function(a,b){e.call(this,a,b),f.call(this)},spread:function(a,b){var c=new j;return e.call(this,a,b,c,1),f.call(this),c.promise}},d.prototype.then=d.prototype.when=function(a,b){var c=new j;return e.call(this,a,b,c),f.call(this),c.promise},d.prototype.fail=d.prototype["catch"]=function(a){return this.then(null,a)},d.prototype.fin=d.prototype["finally"]=function(a){var b=new j;return this.then(function(c){a(),b.resolve(c)},function(c){a(),b.reject(c)}),b.promise};var l=i.toPromis=function(a,b){if(a instanceof d)return a;var c=typeof a,e=new j;if("function"!=c&&"object"!=c||"function"!=typeof a.then){if("function"!=c||b)return e.resolve(a),e.promise;try{var f=a()}catch(g){return e.reject(g),e.promise}return l(f,!0)}try{a.then(e.resolve,e.reject)}catch(g){e.reject(g)}return e.promise};i.all=function(a){for(var b=new j,c=[],d=0,e=0;e<a.length;e++)!function(){var f=e;h(function(){var e=a[f];l(e).then(function(e){c[f]=e,d++,d==a.length&&b.resolve(c)},function(a){b.reject(a)})},0)}();return b.promise},i.resolve=function(a){return i.toPromis(a,!0)},i.reject=function(a){var b=new j;return b.reject(a),b.promise},i.allMap=function(a){var b=new j,c={},d=+function(){var b=0;for(var c in a)b++;return b}();for(var e in a)!function(){var f=e;h(function(){var e=a[f];l(e).then(function(a){c[f]=a,d--,d||b.resolve(c)},function(a){b.reject(a)})},0)}();return b.promise},i.any=i.race=function(a){for(var b=new j,c=0;c<a.length;c++)+function(){var d=c;h(function(){var c=a[d];l(c).then(function(a){b.resolve(a)},function(a){b.reject(a)})},0)}();return b.promise},i.nfcall=function(a){var b=this===i?null:this,c=new j,d=Array.prototype.slice.call(arguments,1);return d.push(g(c)),a.apply(b,d),c.promise},i.nfapply=function(a,b){var c=this===i?null:this,d=new j;if("[object Array]"!==Object.prototype.toString.call(b))throw"args TypeError";return b.push(g(d)),a.apply(c,b),d.promise},i.denodeify=function(a){var b=this===i?null:this;return function(){return i.nfapply.call(b,a,Array.prototype.slice.call(arguments))}},i.delay=function(a){var b=new j;return setTimeout(b.resolve,a),b.promise},b.exports=i}).call(this,a("_process"))},{_process:4}],3:[function(a,b,c){(function(c){var d="object"==typeof c&&c.nextTick?c.nextTick:setTimeout;b.exports=function(b){"use strict";function c(a){var b={errNo:0,Queue_event:1,regs:[]},c=["event_succ","event_err","Queue_event","timeout"];for(var d in b)this[d]=b[d];this.fun=a[0];var e=a[1];e instanceof Array&&(this.regs=e);var f=a.length>1?a[a.length-1]:!1;if(f&&"object"==typeof f&&!(f instanceof Array))for(d in c){var g=c[d];"undefined"!=typeof f[g]&&(this[g]=f[g])}this.defer=h()}function e(a){var b={event_succ:function(){},event_err:function(){},event_begin:function(){},event_end:function(){},event_add:function(){},retryNo:0,retryType:0,timeout:0};this.max=a,this.lins=[],this.ing=0,this.isStart=0,this.isStop=0,this._option=b;var c=arguments[arguments.length-1];if("function"==typeof arguments[1]&&(this._option.event_succ=arguments[1]),"function"==typeof arguments[2]&&(this._option.event_err=arguments[2]),"function"==typeof arguments[3]&&(this._option.event_begin=arguments[3]),"function"==typeof arguments[4]&&(this._option.event_end=arguments[4]),"object"==typeof c)for(var d in b)"undefined"!=typeof c[d]&&(this._option[d]=c[d])}var f,g=a("./Q"),h=function(){return f?f.defer?f.defer():f():void 0};return f=b&&"function"==typeof b&&b.defer?b:g,e.prototype={option:function(a){return 1==arguments.length?this._option[a]:void(arguments.length>1&&(this._option[a]=arguments[1]))},next:function(){if(this.ing<this.max&&!this.isStop){var a=this.lins.shift(),b=this;if(a){var c,e,f,h=0;b.isStart||d(function(){g.toPromis(function(){b._option.event_begin.call(b)})}),b.isStart=1,b.ing+=1,f=g.toPromis(function(){return a.fun.apply(null,a.regs)});var i=function(){return c&&clearTimeout(c),c=0,h++?!0:void b.ing--},j=function(c){i()||(a.defer&&a.defer.resolve(c),d(function(){a.event_succ&&g.toPromis(function(){a.event_succ.call(b,c,a)})},0),d(function(){a.Queue_event&&g.toPromis(function(){b._option.event_succ.call(b,c,a)})},0),b.isStop||b.start())},k=function(c){"timeout"==c&&(e=1),i()||(a.errNo++,b._option.retryNo>a.errNo-1?(b._option.retryType?b.jump(a):b.push(a),b.isStop||b.start()):(a.defer&&a.defer.reject(c),d(function(){a.event_err&&g.toPromis(function(){a.event_err.call(b,c,a)})},0),d(function(){a.Queue_event&&g.toPromis(function(){b._option.event_err.call(b,c,a)})},0),b.isStop||b.start()))};if(f.then(j,k),"undefined"!=typeof a.timeout||b._option.timeout>0){var l=b._option.timeout;l="undefined"!=typeof a.timeout?+a.timeout:l,l>0&&(c=setTimeout(function(){k("timeout")},l))}}else 0===b.ing&&b.isStart&&(b.isStart=0,d(function(){g.toPromis(function(){b._option.event_end.call(b)})},0))}},toObj:function(a){if(a instanceof c)return a;if("function"==typeof a)return new c(Array.prototype.slice.call(arguments));throw new Error("Argument TypeError!")},push:function(){var a=this,b=a.toObj.apply(a,arguments);return a.lins.push(b),g.toPromis(function(){a._option.event_add.apply(a,b)}),b.defer.promise},unshift:function(){var a=this,b=a.toObj.apply(a,arguments);return a.lins.unshift(b),g.toPromis(function(){a._option.event_add.apply(a,b)}),b.defer.promise},go:function(a){var b=this,c=b.toObj.apply(b,arguments);return b.lins.push(c),g.toPromis(function(){b._option.event_add.apply(b,c)}),b.start(),c.defer.promise},jump:function(a){var b=this,c=b.toObj.apply(b,arguments);return b.lins.unshift(c),g.toPromis(function(){b._option.event_add.apply(b,c)}),b.start(),c.defer.promise},all:function(a,b,c){for(var d=[],e=this,f=0;f<a.length;f++)+function(){var b=f,g=a[b],h=c?e.unshift.apply(e,g):e.push.apply(e,g);d.push(h)}();var i=h();return g.all(d).then(function(a){i.resolve(a)},function(a){i.reject(a)}),b&&this.start(),i.promise},allLike:function(a,b,c){var d,e,f,i=[],j=2,k=this;"object"==typeof c?(d=c,j++):c=null,e=arguments[j],f=arguments[++j];for(var l=0;l<a.length;l++)+function(){var d=l,e=Array.prototype.concat.call([],a[d]),g=f?k.unshift(b,e,c):k.push(b,e,c);i.push(g)}();var m=h();return g.all(i).then(function(a){m.resolve(a)},function(a){m.reject(a)}),e&&this.start(),m.promise},allEach:function(a,b,c){var d,e,f,i=[],j=2,k=this;"object"==typeof c?(d=c,j++):c=null,e=arguments[j],f=arguments[++j];for(var l in a)+function(){var d=l,e=Array.prototype.concat.call([],a[d],d,a),g=f?k.unshift(b,e,c):k.push(b,e,c);i.push(g)}();var m=h();return g.all(i).then(function(a){m.resolve(a)},function(a){m.reject(a)}),e&&this.start(),m.promise},allMap:function(a,b,c){var d,e,f,i={},j=2,k=this;"object"==typeof c?(d=c,j++):c=null,e=arguments[j],f=arguments[++j];for(var l in a)+function(){var d=l,e=Array.prototype.concat.call([],a[d],d,a),g=f?k.unshift(b,e,c):k.push(b,e,c);i[d]=g}();var m=h();return g.allMap(i).then(function(a){m.resolve(a)},function(a){m.reject(a)}),e&&this.start(),m.promise},start:function(){this.isStop=0;do this.next();while(this.lins.length&&this.ing<this.max)},stop:function(){this.isStop=1},setMax:function(a,b){0>=a||(this.max=a,b||this.start())},clear:function(a){for(;this.lins.length;){var b=this.lins.shift();b.defer.reject(a)}}},e.prototype.allArray=e.prototype.allLike,e}}).call(this,a("_process"))},{"./Q":2,_process:4}],4:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],5:[function(a,b,c){!function(a,b){if("function"==typeof define&&(define.amd||define.cmd))define([],b);else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("加载 "+a+" 模块失败！，请检查您的环境！");var c="undefined"!=typeof window?window:self;c[a]=b()}}("queueFun",function(){return a("./")})},{"./":1}]},{},[5]);